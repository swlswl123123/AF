close all; clear all;
%% 模糊函数仿真
% OFDM参数
% OFDM块时长5us，带宽100MHz，10个OFDM块，采样率128MHz
B = 100e6;
T_OFDM = 5e-6;
Num_OFDM = 10;
% 插值参数
up_sample = 8;
% radar参数(基带，未加载频)
C = 3e8;
fsr = 128e6;
Ba = 50e3; % 多普勒带宽是50kHz
Nf = 1000; % 频偏采样点数
Tr = T_OFDM*Num_OFDM;
Nr = ceil(Tr*fsr);
tr = (0:Nr-1)/fsr;
%% 生成OFDM发射信号
st = Gen_OFDM(Num_OFDM,B,T_OFDM);
% 1024MHz 55~73MHz 过渡
lpf = [0.00234614889865095,-0.00170829602739502,-0.00155777842496269,-0.00155101949986169,-0.00154115515064473,-0.00142421647875397,-0.00114017655527567,-0.000673374762570232,-5.43905994990432e-05,0.000646730308787491,0.00132893392148410,0.00187771997256790,0.00218209214944588,0.00215897009370727,0.00176741121212274,0.00102640914441071,1.45490197076814e-05,-0.00113162432998130,-0.00223653600636567,-0.00310932385437785,-0.00357516939508899,-0.00350548950686671,-0.00284745315739071,-0.00163989368584920,-1.78982379818042e-05,0.00179980357369554,0.00353484476489707,0.00489087551933593,0.00559986201016210,0.00547186840211149,0.00443102319051596,0.00254302555206581,1.97952779426782e-05,-0.00279640463162095,-0.00548123686674487,-0.00757916142032680,-0.00868045439217527,-0.00848928473192573,-0.00688342736015553,-0.00395626064964292,-2.23601870859014e-05,0.00440259167243762,0.00866405461480816,0.0120501442427604,0.0139012417325563,0.0137094016409431,0.0112281389310865,0.00652222609765187,2.44894438666158e-05,-0.00750580486981549,-0.0150383474416486,-0.0213671065531244,-0.0252767371894669,-0.0256822706784512,-0.0217858947795580,-0.0131968734171978,-2.55694625124324e-05,0.0170967861394410,0.0370478761811115,0.0583187118636786,0.0791542924526041,0.0977430169587573,0.112407311394885,0.121794699774307,0.125025040021419,0.121794699774307,0.112407311394885,0.0977430169587573,0.0791542924526041,0.0583187118636786,0.0370478761811115,0.0170967861394410,-2.55694625124324e-05,-0.0131968734171978,-0.0217858947795580,-0.0256822706784512,-0.0252767371894669,-0.0213671065531244,-0.0150383474416486,-0.00750580486981549,2.44894438666158e-05,0.00652222609765187,0.0112281389310865,0.0137094016409431,0.0139012417325563,0.0120501442427604,0.00866405461480816,0.00440259167243762,-2.23601870859014e-05,-0.00395626064964292,-0.00688342736015553,-0.00848928473192573,-0.00868045439217527,-0.00757916142032680,-0.00548123686674487,-0.00279640463162095,1.97952779426782e-05,0.00254302555206581,0.00443102319051596,0.00547186840211149,0.00559986201016210,0.00489087551933593,0.00353484476489707,0.00179980357369554,-1.78982379818042e-05,-0.00163989368584920,-0.00284745315739071,-0.00350548950686671,-0.00357516939508899,-0.00310932385437785,-0.00223653600636567,-0.00113162432998130,1.45490197076814e-05,0.00102640914441071,0.00176741121212274,0.00215897009370727,0.00218209214944588,0.00187771997256790,0.00132893392148410,0.000646730308787491,-5.43905994990432e-05,-0.000673374762570232,-0.00114017655527567,-0.00142421647875397,-0.00154115515064473,-0.00155101949986169,-0.00155777842496269,-0.00170829602739502,0.00234614889865095];
%% 生成模糊函数
[AF_OFDM_cmp, AF_OFDM_abs, AF_OFDM_log] = AF_gen(st, Tr, fsr, Ba, Nf, up_sample, lpf, 0);

%% 生成LFM发射信号
k = B/Tr;
fsr = fsr * 10;
Nr = ceil(Tr*fsr);
tr = (0:Nr-1)/fsr;
LFM = exp(1i*pi*k*tr.^2);
[AF_LFM_cmp, AF_LFM_abs, AF_LFM_log] = AF_gen(LFM, Tr, fsr, Ba, Nf, 1, lpf, 1);
